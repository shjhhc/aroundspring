$.L = {}; $.L.version = "0.0.1", function () { $.extend($.L, { CONSTS: { pager: { TOTAL_MESSAGE: "共{0}条记录,当前{1}/{2}页", TOTAL_MESSAGE_ZREO: "共0条记录", PARAMETER_ERROR: "分页参数有错误", FIRST_PAGE: "首页", PRE_PAGE: "上一页", LAST_PAGE: "末页", NEXT_PAGE: "下一页", PAGEINDEX_OVERFLOW: "页索引超出范围" }, message: { Not_Found: "请求地址错误", Internal_Server_Error: "服务器内部错误" } } }) }(jQuery), function () { $.extend($.L, { stringFormat: function (n, t) { var i, r; if (t.length == 0) return null; for (i = 0; i < t.length; i++) r = new RegExp("\\{" + i + "\\}", "gm"), n = n.replace(r, t[i]); return n }, defaultValue: function (n, t) { return n !== undefined && n !== "" ? n : t }, ellipsis: function (n, t) { return n && n.length > t ? n.substr(0, t) + "..." : n }, renderToDate: function (data) { if (data == null) return data; return eval("new " + data.replace("/", "", "g").replace("/", "", "g")) }, dateFormat: function (n, t) { var r = { "M+": n.getMonth() + 1, "d+": n.getDate(), "h+": n.getHours(), "m+": n.getMinutes(), "s+": n.getSeconds(), "q+": Math.floor((n.getMonth() + 3) / 3), S: n.getMilliseconds() }, i; /(y+)/.test(t) && (t = t.replace(RegExp.$1, (n.getFullYear() + "").substr(4 - RegExp.$1.length))); for (i in r) new RegExp("(" + i + ")").test(t) && (t = t.replace(RegExp.$1, RegExp.$1.length == 1 ? r[i] : ("00" + r[i]).substr(("" + r[i]).length))); return t }, hasRepeat: function (n) { var i, t; if (!n || n.length == 0 || n.length == 1) return !1; for (i = [], t = 0; t < n.length; t++) $.inArray(n[t], i) || i.push(n[t]); return n.length > i.length }, padLeft: function (n, t, i) { var u, r; if (n.length >= t) return n; for (u = n.length, r = 0; r < t - u; r++) n = i + n; return n }, padRight: function (n, t, i) { var u, r; if (n.length >= t) return n; for (u = n.length, r = 0; r < t - u; r++) n = n + i; return n }, addFavorite: function (n, t) { try { window.external.addFavorite(n, t) } catch (i) { try { window.sidebar.addPanel(t, n, "") } catch (i) { alert("加入收藏失败，请使用Ctrl+D进行添加") } } }, setHome: function (n, t) { if (!$.isIE) { alert("您的浏览器不支持自动设置主页，请使用浏览器菜单手动设置。"); return } var i = t; i || (i = window.location.href); n.style.behavior = "url(#default#homepage)"; n.setHomePage(i) } }) }(jQuery), function () { $.fn.extend({ enterKey: function (n) { $(this).keydown(function (t) { t.keyCode == $.CONSTS.keyCode.ENTER && n() }) } }) }(jQuery), function () { $.extend($.L, { showModal: function (n) { $("body").append('<div class="lgh_modal" id="lgh_modal"><\/div>'); n && $("#lgh_modal").click(function () { n() }) }, closeModal: function () { $("#lgh_modal").remove() } }) }(jQuery), function () { $.extend($.L, { loadingIcon: function (n, t) { this.loadingIconClose(); n || (n = 1); var i = { modal: !0, container: $("body") }; $.extend(i, t); i.modal == !0 && this.showModal(); i.container.append('<div class="lgh_loadingIcon lgh_loadingIcon_' + n + '" id="lgh_loading"><\/div>') }, loadingIconClose: function () { this.closeModal(); $("#lgh_loading").remove() } }) }(jQuery), function () { var t = $.L, n = null; $.extend($.L, { messageQClose: function (n) { this.closeModal(); $("#lgh_messageQ").remove(); n && n() }, messageQ: function (t, i, r) { function f(n, t) { return '<div id="lgh_messageQ" class="lgh_messageQ lgh_message' + n + 'Q"><div class="lgh_messageQ_Icon"><\/div><div class="lgh_messageQ_Html">' + t + "<\/div><\/div>" } function e(n, t) { n.append(t); var i = $("#lgh_messageQ").width(), r = $("#lgh_messageQ").height(); $("#lgh_messageQ").css({ "margin-left": "-" + i / 2 + "px", "margin-top": "-" + r / 2 + "px" }).fadeIn() } n && clearTimeout(n); this.messageQClose(); var u = f(t, i); this.showModal(function () { t != "Success" && t != "Loading" && $.L.messageQClose(r) }); e($("body"), u); t == "Success" && (n = setTimeout(function () { $.L.messageQClose(r) }, 1500)) }, messageLoadingQ: function (n, t) { this.messageQ("Loading", n, t) }, messageSuccessQ: function (n, t) { this.messageQ("Success", n, t) }, messageWarningQ: function (n, t) { this.messageQ("Warning", n, t) }, messagePromptQ: function (n, t) { this.messageQ("Prompt", n, t) }, messageErrorQ: function (n, t) { this.messageQ("Error", n, t) } }) }(jQuery), function () { var n = $.L; $.extend($.L, { messageTClose: function (n) { this.closeModal(); $("#lgh_messageT").remove(); n && n() }, messageT: function (n, t, i, r) { function f(n, t) { return '<div id="lgh_messageT" class="lgh_messageT lgh_message' + n + 'T"><div class="lgh_messageT_Icon"><\/div><div class="lgh_messageT_Html">' + t + '<\/div><div class="lgh_messageT_Button">' + e() + "<\/div><\/div>" } function e() { return n == "Success" ? "<a class='tbutton'>确定<\/a>" : n == "Error" || n == "Warning" ? "<a class='tbutton'>关闭<\/a>" : n == "Confirm" ? "<a a_type='cancle' class='tbutton'>取消<\/a><a class='tbutton'>确定<\/a> " : void 0 } function o(n, t) { n.append(t); s(); var i = $("#lgh_messageT").width(), r = $("#lgh_messageT").height(); i += 36; r += 36; $("#lgh_messageT").css({ "margin-left": "-" + i / 2 + "px", "margin-top": "-" + r / 2 + "px" }).fadeIn() } function s() { $("#lgh_messageT").find("a.tbutton").click(function () { var n = this; $.L.messageTClose(function () { $(n).attr("a_type") == "cancle" ? r && r() : i && i() }) }) } this.messageTClose(); var u = f(n, t); this.showModal(); o($("body"), u) }, messageConfirmT: function (n, t) { this.messageT("Confirm", n, t) }, messageSuccessT: function (n, t) { this.messageT("Success", n, t) }, messageWarningT: function (n, t) { this.messageT("Warning", n, t) }, messageErrorT: function (n, t) { this.messageT("Error", n, t) } }) }(jQuery), function () { $.fn.extend({ L_loadingIcon: function (n, t) { t || (t = {}); t.container = $(this); $.L.loadingIcon(n, t) } }) }(jQuery), function () { $.extend($.L, { createPageData: function (n, t, i) { if (!n) return null; t || (t = 1); var r = { PageIndex: t, PageSize: i, TotalItemCount: 0, PageData: null }; return n ? (r.TotalItemCount = n.length, r.PageData = $.grep(n, function (n, r) { return r + 1 > (t - 1) * i && r + 1 <= t * i }), r) : null } }); $.fn.extend({ formSubmit: function (n) { $(this).find("input[type='hidden'][name='pageIndex']").size() == 0 && $(this).append("<input type='hidden' id='pageIndex' name='pageIndex'/>"); $(this).find("input[type='hidden'][name='pageIndex']") && (n ? $(this).find("input[type='hidden'][name='pageIndex']").val(n) : $(this).find("input[type='hidden'][name='pageIndex']").val(""), $(this).submit()) }, createPager: function (n) { function k(n, t, i) { var u = [], o = i / 2, r; if (t <= i) for (r = 2; r < t; r++) u.push(r); else if (n <= o) for (e = !0, r = 2; r < 3 + o; r++) u.push(r); else if (n >= t - o + 1) for (f = !0, r = t - i + 3; r < t; r++) u.push(r); else for (f = !0, e = !0, r = n - o + 2; r <= n + o - 2; r++) u.push(r); return u } function d(n) { return t.formId && typeof t.formId == "string" ? $.L.stringFormat('JavaScript:$("#{0}").formSubmit({1})', [t.formId, n]) : t.linkClick && typeof t.linkClick == "string" ? $.L.stringFormat("JavaScript:{0}({1})", [t.linkClick, n]) : t.linkClick == null ? g(n) : void 0 } function g(n) { if (window.location.search == "") return window.location.href + "?pageIndex=" + n; var t = window.location.href.substring(0, window.location.href.indexOf("?")); return window.location.search.indexOf("?pageIndex") == -1 ? t + "?pageIndex=" + n + "&" + window.location.search.substring(1) : window.location.search.indexOf("&") != -1 ? t + "?pageIndex=" + n + window.location.search.substring(window.location.search.indexOf("&")) : t + "?pageIndex=" + n } function r(n, t) { var i = [], r = d(n); return i.push(r), i.push(t), i } var i = "", f = !1, e = !1, c = !0, l = !0, a = "<span class='total'>" + $.L.CONSTS.pager.TOTAL_MESSAGE + "<\/span>", nt = "<span class='total'>" + $.L.CONSTS.pager.TOTAL_MESSAGE_ZREO + "<\/span>", u = "<a href='{0}'>{1}<\/a>", v = "<a href='JavaScript:;' class='sel'>{1}<\/a>", y = $.L.CONSTS.pager.PARAMETER_ERROR, tt = $.L.CONSTS.pager.FIRST_PAGE, p = $.L.CONSTS.pager.PRE_PAGE, it = $.L.CONSTS.pager.LAST_PAGE, w = $.L.CONSTS.pager.NEXT_PAGE, o = $.L.CONSTS.pager.PAGEINDEX_OVERFLOW, t = { pageIndex: 1, pageSize: 10, total: null, pageNum: 0, pageCount: 8, formId: null, needButton: !1, linkClick: null, linkFun: null, numberVisible: !0 }, b, s, h; if ($.extend(t, n), $(this).html(""), $(this).attr("numberVisible") == "false" && (t.numberVisible = !1), $(this).attr("pageCount") && (t.pageCount = parseInt($(this).attr("pageCount"))), !n || !n.total && n.total != 0) { $.messageWarning(y); return } if (t.pageNum = t.total == 0 ? 0 : Math.ceil(t.total / t.pageSize), t.pageNum == 0 || t.pageCount == 0 || t.pageNum == 1) { $(this).attr("container") ? $("#" + $(this).attr("container")).hide() : $(this).hide(); return } $(this).attr("container") ? $("#" + $(this).attr("container")).show() : $(this).show(); $(this).addClass("lgh_pager"); $(this).attr("PageIndex", t.pageIndex); i = $.L.stringFormat($(this).attr("totalFormat") ? "<span class='total'>" + $(this).attr("totalFormat") + "<\/span>" : a, [t.total, t.pageIndex, t.pageNum]); t.pageIndex != 1 && (c = !0); t.pageIndex != t.pageNum && (l = !0); b = k(t.pageIndex, t.pageNum, t.pageCount); i += "<ul class='pager'>"; i += t.pageIndex == 1 ? '<li class="disabled"><a href="JavaScript:;">上一页<\/a><\/li>' : "<li >" + $.L.stringFormat(u, r(t.pageIndex - 1, p)) + "<\/li>"; i += t.pageIndex >= t.pageNum ? '<li class="disabled"><a href="JavaScript:;">下一页<\/a><\/li>' : "<li >" + $.L.stringFormat(u, r(t.pageIndex + 1, w)) + "<\/li>"; i += "<\/ul>"; $(this).html(i); s = t.linkFun; h = t.pageNum; $(this).find("input[type='text']").length != 0 && ($(this).find("input[type='text']").blur(function () { if ($(this).val() != "") /^[1-9]\d*$/.test($(this).val()) ? parseInt($(this).val()) > h && (alert(o), $(this).val(""), $(this).focus()) : (alert(o), $(this).val(""), $(this).focus()) }), $(this).find("input[type='button']").click(function () { s(parseInt($(this).siblings("input[type='text']").val())) })) } }) }(jQuery), function () { $.extend($.L, { ajaxHandle: function (n) { var t = { url: "", type: "POST", data: {}, loading: 1, loadingContainer: $("body"), error: function () { }, success: function () { } }; $.extend(t, n); $.ajax({ type: t.type, url: t.url, data: t.data, beforeSend: function () { t.loading && $.L.loadingIcon(t.loading, { container: t.loadingContainer }) }, error: function (n) { $.L.loadingIconClose(); $.L.messageErrorT("【" + n.status + "】") }, success: function (n) { $.L.loadingIconClose(); setTimeout(function () { $.L.ajaxResultHandle(n, t.success) }, 300) } }) }, ajaxResultHandle: function (n, t) { if (n) if (n.e_type) { if (n.e_type == "modelstate") for (var i in n.e_content) $.L.showElementModelStateMsg(i, n.e_content[i]) } else t && t(n) }, showElementModelStateMsg: function (n, t) { var r, i; if (typeof n == "string") { r = $("form [name='" + n + "']"); i = $("span[data-valmsg-for='" + n + "']"); r.addClass("input-validation-error"); i.removeClass("field-validation-valid").addClass("field-validation-error"); i.html('<span class="" for="' + n + '" generated="true">' + t + "<\/span>"); r.one("focus", function () { r.removeClass("input-validation-error"); i.removeClass("field-validation-error").addClass("field-validation-valid"); i.html("") }) } else { r = n; i = $("span[data-valmsg-for='" + n.attr("name") + "']"); r.addClass("input-validation-error"); i.removeClass("field-validation-valid").addClass("field-validation-error"); i.html('<span class="" for="' + n.attr("name") + '" generated="true">' + t + "<\/span>"); r.one("focus", function () { r.removeClass("input-validation-error"); i.removeClass("field-validation-error").addClass("field-validation-valid"); i.html("") }) } }, removeElementModelStateMsg: function (n) { var i, t; typeof n == "string" ? (i = $("form [name='" + n + "']"), t = $("span[data-valmsg-for='" + n + "']"), i.removeClass("input-validation-error"), t.removeClass("field-validation-error").addClass("field-validation-valid"), t.html("")) : (i = n, t = $("span[data-valmsg-for='" + n.attr("name") + "']"), i.removeClass("input-validation-error"), t.removeClass("field-validation-error").addClass("field-validation-valid"), t.html("")) } }) }(jQuery), function () { function n(n, t) { return n ? (t || (t = "yyyy-MM-dd hh:mm:ss"), $.L.dateFormat($.L.renderToDate(n), t)) : "" } function t(n) { return n ? $.L.dateFormat($.L.renderToDate(n), "yyyy-MM-dd") : "" } function i(n) { return n ? $.fileSize(n) : "" } function r(n, t) { if (!n) return ""; t || (t = "yyyy-MM-dd hh:mm:ss"); n = n.replace("GMT+08:00", "GMT+08"); n = n.replace("GMT+0800", "GMT+08"); n = n.replace("+0800", "GMT+08"); var i = new Date(n); return $.L.dateFormat(i, t) } function u(n) { if (!n) return ""; n = n.replace("GMT+08:00", "GMT+08"); var t = new Date(n); return $.L.dateFormat(t, "yyyy-MM-dd") } $.fn.extend({ L_bindingDataProperty: function (n, t) { function c(n, t, i, r, u) { var f; return t ? $.inArray(t, $.dataBinder.options.typename) != -1 ? $.dataBinder.options.rule[t](s(u, n)) : t.indexOf && t.indexOf("datetime=") != -1 ? (f = t.split("="), $.dataBinder.options.rule.datetime(s(u, n), f[1])) : t.indexOf && t.indexOf("datetimeGMT=") != -1 ? (f = t.split("="), $.dataBinder.options.rule.datetimeGMT(s(u, n), f[1])) : t(s(u, n, !0), u, r) : i ? a(i, n, u) : s(u, n) } function l(obj) { if (obj && obj.attr("binding")) { var _bindingStr = obj.attr("binding"), returnObj; try { returnObj = eval("(" + _bindingStr + ")") } catch (e) { alert("GetL_bindingDataProperty" + e) } if (returnObj.source) try { returnObj = eval("(" + returnObj.source + ")") } catch (e) { alert("GetL_bindingDataProperty" + e) } return returnObj } return null } function a(n, t, i) { var r = t.split(","); return $.L.stringFormat(n, $.map(r, function (n) { return s(i, n) })) } function s(n, i, r) { var f; if (i == undefined || i == null || i == "") return n; if (i.indexOf(".") == -1) return n[i] === 0 && !r ? "0" : n[i] == undefined || n[i] == null ? "" : n[i]; var e = i.split("."), u = n, o = 0; for (e[0] == "base" && t && (u = t, o = 1), f = o; f < e.length; f++) u != null && u != undefined && (u = u[e[f]]); return u } var i = l($(this)), r, u, f, e, h, o; if (i) for (r in i) r.indexOf("Format") == -1 && r.indexOf("Handle") == -1 && r.indexOf("Length") == -1 && r.indexOf("Data") == -1 && r.indexOf("lazyLoad") == -1 && (r == "text" ? (u = c(i.text, i.textHandle, i.textFormat, $(this), n), u != null && u != undefined && (i.textData && i.textData[u] ? $(this).text(i.textData[u]) : i.textLength ? ($(this).text($.ellipsis(u, i.textLength)), $(this).attr("title", u)) : $(this).text(u))) : r == "html" ? (f = c(i.html, i.htmlHandle, i.htmlFormat, $(this), n), f != null && f != undefined && (i.htmlData && i.htmlData[f] ? $(this).html(i.htmlData[f]) : $(this).html(f))) : r == "value" ? (e = c(i.value, i.valueHandle, i.valueFormat, $(this), n), e != null && e != undefined && (i.valueData && i.valueData[e] ? $(this).val(i.valueData[e]) : $(this).val(e))) : r == "list" ? (h = "BindingTemplete_" + $(this).attr("list_id"), window[h] || (window[h] = $(this).html()), $(this).L_bindingDataList(n[i.list], { bindingformat: window[h], baseData: n })) : (o = c(i[r], i[r + "Handle"], i[r + "Format"], $(this), n), o != null && o != undefined && (i[r + "Data"] && i[r + "Data"][o] ? $(this).attr(r, i[r + "Data"][o]) : $(this).attr(r, o)))) }, L_bindingData: function (n, t) {return $(this).find("[binding]").add(this).each(function () { $(this).L_bindingDataProperty(n, t) }), $(this) }, L_bindingDataList: function (list, para) { var bindingformat, baseData, property, data, i, formatObj; if ((para || (para = {}), bindingformat = para.bindingformat, baseData = para.baseData, $(this).size() != 0) && $(this).length != undefined) { if (bindingformat || $(this).data("BindingFormat") || ($(this).data("BindingFormat", $(this).html()), $(this).html(""), $(this).hide()), !bindingformat && !$(this).data("BindingFormat")) return $(this); if (bindingformat || (bindingformat = $(this).data("BindingFormat")), property = eval("(" + $(this).attr("binding") + ")"), data = list, property && property.pageId && (data = list.PageData), property && property.emptyHtml && (!data || data.length == 0)) return property.emptyHtml.indexOf("#") == 0 && (property.emptyHtml = $(property.emptyHtml).html()), $(this).html(property.emptyHtml), $(this).show(), property.pageId && $("#" + property.pageId).html(""), $(this); if (!data) return $(this); for ($(this).html(""), i = 0; i < data.length; i++) formatObj = $(bindingformat), data[i].Binding_Index = i + 1, formatObj.L_bindingData(data[i], baseData), $(this).append(formatObj), para.itemHandle && para.itemHandle(i, formatObj, data[i]); return $(this).show(), property && property.pageId && $("#" + property.pageId).createPager({ pageIndex: list.PageIndex, pageSize: list.PageSize, total: list.TotalItemCount, formId: property.formId ? property.formId : null, linkClick: property.pageCallback }), $(this) } } }); $.dataBinder = { options: { typename: ["datetime", "filesize", "datetimeGMT", "datetime_Date", "datetimeGMT_Date"], rule: { datetime: n, filesize: i, datetimeGMT: r, datetime_Date: t, datetimeGMT_Date: u } }, addMethod: function (n, t) { $.dataBinder.options.typename.push(n); $.dataBinder.options.rule[n] = t } } }(jQuery), function () { $.extend({ w_socket: function (n) { var t = { url: "", onstart: function () { }, onopen: function () { }, onclose: function () { }, onerror: function () { }, onmessage: function () { }, onexception: function () { }, onnotsupport: function () { } }, r, i, u; $.extend(t, n); r = {}; try { if (u = "MozWebSocket" in window ? "MozWebSocket" : "WebSocket" in window ? "WebSocket" : null, u == null) return t.onnotsupport(), null; i = new window[u](t.url); i.onopen = function () { t.onopen() }; i.onclose = function () { t.onclose() }; i.onerror = function () { t.onerror() }; i.onmessage = function (evt) { t.onmessage(eval("(" + evt.data + ")"), evt.data) } } catch (f) { t.onexception(f); return null } return r.send = function (n) { typeof n == "string" ? i.send(n) : i.send($.jsonString(n)) }, r.socket = i, r } }) }(jQuery), function (n) { n.extend({ cookie: function (n, t, i) { var f, r, e, o, u, s; if (typeof t != "undefined") { i = i || {}; t === null && (t = "", i.expires = -1); f = ""; i.expires && (typeof i.expires == "number" || i.expires.toUTCString) && (typeof i.expires == "number" ? (r = new Date, r.setTime(r.getTime() + i.expires * 864e5)) : r = i.expires, f = "; expires=" + r.toUTCString()); var h = i.path ? "; path=" + i.path : "", c = i.domain ? "; domain=" + i.domain : "", l = i.secure ? "; secure" : ""; document.cookie = [n, "=", encodeURIComponent(t), f, h, c, l].join("") } else { if (e = null, document.cookie && document.cookie != "") for (o = document.cookie.split(";"), u = 0; u < o.length; u++) if (s = jQuery.trim(o[u]), s.substring(0, n.length + 1) == n + "=") { e = decodeURIComponent(s.substring(n.length + 1)); break } return e } }, setCookie: function (n, t, i) { var u, r; i = i || {}; t === null && (t = "", i.expires = -1); u = ""; i.expires && (typeof i.expires == "number" || i.expires.toUTCString) && (typeof i.expires == "number" ? (r = new Date, r.setTime(r.getTime() + i.expires * 864e5)) : r = i.expires, u = "; expires=" + r.toUTCString()); var f = i.path ? "; path=" + i.path : "", e = i.domain ? "; domain=" + i.domain : "", o = i.secure ? "; secure" : ""; document.cookie = [n, "=", encodeURIComponent(t), u, f, e, o].join("") }, getCookie: function (n) { var u = null, i, t, r; if (document.cookie && document.cookie != "") for (i = document.cookie.split(";"), t = 0; t < i.length; t++) if (r = jQuery.trim(i[t]), r.substring(0, n.length + 1) == n + "=") { u = decodeURIComponent(r.substring(n.length + 1)); break } return u }, deleteCookie: function (t) { var i = new Date, r; i.setTime(i.getTime() - 1); r = n.getCookie(t); r != null && (document.cookie = t + "=" + r + ";expires=" + i.toGMTString()) } }) }(jQuery)